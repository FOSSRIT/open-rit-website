{% comment %}
A searchable and filterable grid to display our fellows' projects.
Must be loaded with the projects_search.js script in order to function.
{% endcomment %}

{% assign filters = "typeLong|college" | split: "|" %}

<noscript>
	<p class="error">
		Sorry, projects searching requires JavaScript to be enabled in order to
		function. Please enable JavaScript to search projects.
	</p>
</noscript>
<div id="projects-grid">
	<div id="projects-search" class="hidden">
		<input
			id="projects-search-bar"
			type="text"
			placeholder="What are you looking for?"
		/>
		<input class="hidden" type="checkbox" id="filters-toggle" />
		<label class="filters-toggle" for="filters-toggle"><img src="/assets/images/icon/filter.svg" alt=""></label>
	 	<div id="filters-row">
			{% for filter in filters %}
				{% assign capitalized = filter | capitalize %}
				{% assign label = capitalized %}
				{% if label contains 'Long' %}
					{% assign label = label | remove: 'Long' %}
				{% endif %}
				{% comment %}
				Workaround for the fact that you can't do:
					site.projects | map: filter | flatten | uniq
				{% endcomment %}
				{% assign options = ("" | split: ",") %}
				{% for project in site.projects %}
					{% assign options = options | push: project[filter] %}
				{% endfor %}
				{% assign options = options | uniq %}
				{%
				include checkbox-dropdown.html
					label=label
					name=filter
					options=options
				%}
			{% endfor %}
		</div>
	</div>
	<div id="projects-container">
		{% for project in site.projects %}
			<div id="{{ project.mystic-slug }}" class="project">
				<h2>{{ project.project-name }}</h2>
				<p class="owner">{{ project.owner | join: " & " }}</p>
				<hr>
				<p>{{ project.tldr }}</p>
				<div class="icon-row">
					<div class="college"><img src="/assets/images/icon/college.svg" alt=""><p>{{ project.college }}</p></div>
					<div class="type"><img src="/assets/images/icon/tags.svg" alt="">
						<ul>
						{% for short in project.typeShort %}
							<li>{{ short }}</li>
						{% endfor %}
						</ul>
					</div>
				</div>
				<a href="{{ project.url | relative_url }}" class="view-more">View more</a>
			</div>
		{% endfor %}
	</div>
</div>
<script>
	const PROJECTS_DATA = {
		{% for project in site.projects %}
			"{{ project.mystic-slug }}": {
				"name":  "{{ project.project-name        }}",
				"tldr":  "{{ project.tldr                }}",
				"owner": "{{ project.owner | join: ' & ' }}",
				
				{% for filter in filters %}
					"{{ filter }}": [
						{% for value in project[filter] %}
							"{{ value }}",
						{% endfor %}
					],
				{% endfor %}
			},
		{% endfor %}
	};
	const FILTERS = [
		{% for filter in filters %}
			"{{ filter }}",
		{% endfor %}
	];
	init_filters();
	init_search();
</script>
